---
sidebar_position: 10
title: Oracle
slug: .
---

import MarkdownImage from "/src/components/MarkdownImage";
import Link from "@docusaurus/Link";
import { Typography } from "@mui/material";

import OracleInstructions from "/idl/_oracle_instructions.mdx";

import OracleAccountData from "/idl/accounts/OracleAccountData.md";

A Switchboard oracle is a node.js container that sits between the Solana blockchain and the internet and waits for data feed update requests from an oracle queue. An oracle queue is responsible for managing realm permissions and assigning oracles to aggregator updates in a round robin fashion. When an oracle is assigned an update request, it reads in the aggregator job definitions, executes each job, takes the median of the job results, then publishes its result on-chain.

An oracle account is a program derived address (PDA) between the oracle queue it‚Äôs being initialized for, as well as the authority public key which will control it. Before an oracle is granted permissions to use a queue, it must transfer the minimum stake amount, set by the queue, to its escrow wallet. Once an oracle is granted permissions to use a queue‚Äôs resources by the queue authority, it can start heartbeating on-chain, at an interval set by the queue, indicating it is ready to be assigned data feed update requests.

## Queue Configuration

### ‚öôÔ∏èminStake

Oracles are required to provide the queue's `minStake` to the oracle's tokenAccount, which acts as an insurance policy to entice oracle operators to report honest results. Each oracle queue can have different staking requirements to influence its security. If the staking requirement is set too low it could attract dishonest oracles, but if set too high oracles may find a better use of their capital elsewhere.

### ‚öôÔ∏èOracle Rewards

An oracle‚Äôs reward for a given round is determined by the queue's `reward`. Oracles are rewarded each time they submit a result and then reevaluated when an accepted result has been accepted. When a result has been accepted, the oracle rewards are redistributed to the oracles that responded within the acceptable range. The median result filters the outliers and means an attacker needs to control the majority of the assigned oracles in order to skew a result. This is why increasing the queue's `minStake` requirements increases the security of the network because the attacker will need more up-front capital to fund the attack. Oracle‚Äôs get assigned to data feeds in a round robin fashion with feeds scheduled at varying intervals and oracle batchSize's, so even if an attacker controls a large number of the queue's oracles, there is no guarantee their oracles will get assigned to the same feed.

### ‚öôÔ∏èSlashing

Switchboard uses the median oracle response to determine the accepted result. When initializing a queue, the queue `authority` specifies a `varianceToleranceMultiplier` which determines the range oracle responses may differ. An oracle queue defaults to two standard deviations. If a queue has `slashingEnabled`, any oracle who responded outside the acceptable range will be slashed and lose a portion of their staked capital. The slashing amount can be changed by the DAO to further incentivize honest oracle behavior.

## Functions

An oracle is responsible for the following functions:

- [**Provide minStake**](#provide-minStake): Must provide the minimum amount specified by the queue.
- [**Heartbeat**](#heartbeat): Must continually heartbeat in order to be assigned update requests.
- [**Fulfill Update Requests**](#fulfill-update-requests): Must execute assigned update requests honestly to receive the reward.

### üöÄProvide minStake

The oracle‚Äôs escrow wallet is used to provide the minimum stake as a security deposit, receive rewards for successfully fulfilling data feed updates, and if enabled, for slashing if incorrect values are submitted on-chain. The Switchboard oracle container must contain a Solana keypair to pay for the on-chain heartbeats and submitting update results. You may need to periodically withdraw funds from the escrow wallet to your Solana keypair in order to fund on-chain transactions.

**Note:** if an oracle's `tokenAccount` falls below the queue's minimum stake, it will be removed from the queue and any future queue activities will fail.

### üöÄHeartbeat

An oracle must continually heartbeat in order to be assigned update requests.

### üöÄFulfill Update Requests

An oracle must execute assigned update requests honestly to receive the reward. An aggregator contains a set of job definitions along with its configuration, which includes oracle batch size; Oracle batch size is the number of oracles that get assigned to each aggregator update request. When enough oracles respond to an update, the on-chain contract takes the median value of the oracle responses as the final result. If an oracle‚Äôs response falls within the queue‚Äôs set variance threshold, the oracle‚Äôs escrow wallet receives a set amount of tokens, as specified by the queue. If a queue has slashing enabled and the oracle‚Äôs response falls outside the variance threshold, an oracle‚Äôs escrow wallet is deducted the set queue reward. This incentivizes oracle‚Äôs to report honest results and enforces a higher degree of oracle collusion to influence the accepted result.

For example, if a queue has a reward of 12500 tokens and an aggregator has an oracle batch size of 5, then it will cost the aggregator 62500 tokens for every update request, and each oracle receives 12500 tokens. If the oracle results are [$0, $99, $100, $101, $200], then the accepted result will be $100, the first and last oracle will be deducted 12500 tokens each, and the middle 3 oracles will receive a reward of 12500 tokens.

## Account Schema

### üì¶OracleAccountData

<OracleAccountData />

## More Info

- <Link className="link__nocolor" to="/oracle">
    ‚ÑπÔ∏è Run an oracle
  </Link>
